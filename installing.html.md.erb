---
breadcrumb: PCF App Metrics Documentation
title: Installing PCF App Metrics
owner: PCF App Metrics
list_style_none: true 
---

No content at this time.

<!-- 
This document describes how to install and configure Pivotal Cloud Foundry (PCF) App Metrics.

To use the [Custom Metrics](./monitoringpcfmetrics.html#custom-metrics) feature of the PCF App Metrics tile, you must have the Metrics Forwarder tile installed.
However, the PCF App Metrics tile can be installed without the Metrics Forwarder tile. 

For information about the components deployed as part of this install procedure,
see [PCF App Metrics Product Architecture](./architecture.html).

##Upgrade from v1.6.x to v2.0

This section describes upgrading from v1.6.x to v2.0.

### Overview 


### Procedure 

To upgrade to PCF App Metrics v2.0 from 1.6.x, do the following:
  

## New Install of PCF App Metrics

This section describes how to install the PCF App Metrics tile. 

### Add the PCF App Metrics Tile to Ops Manager

To add the PCF App Metrics tile to Ops Manager, do the following: 

1. Download the latest PCF App Metrics v1.6 tile from
   [Pivotal Network](https://network.pivotal.io/products/pcf-metrics).
1. Upload the PCF App Metrics file to your Ops Manager installation.
1. Click  **Add** next to the uploaded product description in the **Available Products**
   view to add PCF App Metrics to the Ops Manager **Installation Dashboard**.

### Configure the PCF App Metrics Tile

This section describes how to configure the PCF App Metrics tile. 

<p class="note"><strong>Note</strong>: The following procedures offer a standard configuration. To customize PCF App Metrics for high capacity, see <a href="sizing.html">Sizing PCF App Metrics for Your System</a>.</p>

1. From the **Installation Dashboard**, click the **PCF App Metrics** tile.
1. Follow the procedures below to configure the PCF App Metrics tile:
  + [Assign Availability Zones (AZs) and Networks](#az)
  + [Configure Metrics Components](#mc-config)
  + [Configure Resources](#resource-config)
  + [Optional: Forward PCF App Metrics Logs to a Syslog Endpoint](#syslog-config)
  + [Import Stemcell](#stemcell)

#### Assign Availability Zones (AZs) and Networks

To configure the **Assign AZs and Networks** pane, do the following: 

1. Click **Assign AZs and Networks**.
1. Select an Availability Zone under **Place singleton jobs**.
   <br>
   Ops Manager runs Metrics jobs with a single instance in this Availability Zone.
1. Select one or more Availability Zones under **Balance other jobs**.
   <br>
   Ops Manager balances instances of Metrics jobs with more than one instance
   across the Availability Zones that you specify.
1. Use the drop-down menu to select a network.
   <br>
   PCF App Metrics should be installed on the same network the Pivotal Application Service (PAS) tile uses.
   However, if you do select a different subnet network, then refer to the table below when you configure
   the subnet network in the PAS tile to make sure that you have
   the ports needed for each of the PCF App Metrics data services.
   
    <table border="1" class="nice">
      <thead>
        <tr>
          <th>Service</th>
          <th>Port</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>PostgreSQL (Logs Data)</td>
          <td>5524</td>
        </tr>
        <tr>
          <td>MySQL (Metrics Data)</td>
          <td>3306</td>
        </tr>
        <tr>
          <td>Redis (Data Caching and Aggregation)</td>
          <td>6379</td>
        </tr>
      </tbody>
    </table>
    
1. Click **Save**.

#### Configure Metrics Components

To configure the **Metrics Components Config** pane, do the following: 

<%= image_tag("metrics-components-config.png", :alt => "Metrics App Components Settings") %>

1. Click **Metrics Components Config**.
1. Review the **MySQL Metrics Queue Count** value.
   You can increase this instance count at any time to accommodate higher levels of inbound metrics traffic. 
1. Review the **PostgreSQL Logs Queue Count** value.
   You can increase this instance count at any time to accommodate higher levels of inbound log traffic. 
1. Review the **Ingestor Count** value.
   You can increase this instance count at any time to accommodate higher levels of Loggregator Firehose traffic. 
1. Review the **Metrics API server instance count** value.
   You can increase this instance count at any time to accommodate deployments with more apps, metrics, and logs.
1. Review the **Metrics Retention Window** value. 
   You can set number of days to retain metrics data from `1` to `14` days.
   PCF App Metrics adds one buffer day to your configured value to prevent pruning within your desired retention window. The retention window begins at UTC±00:00 of the current day and goes back the amount of days you enter in this field, plus the one buffer day added by PCF App Metrics.
1. Review the **Logs Retention Window** value.
   You can set number of days to retain logs data from `1` to `14` days.
   PCF App Metrics adds one buffer day to your configured value to prevent pruning within your desired retention window. The retention window begins at UTC±00:00 of the current day and goes back the amount of days you enter in this field, plus the one buffer day added by PCF App Metrics. 
1. Review the **Logs Max Retention Percentage** value.
   As a preventative measure, you can set the percentage of disk capacity used before triggering automatic log pruning to prevent Postgres failures. The default is `85`.
1. Review the **Logs Disk Size Pruning Interval** value.
   You can set the length of time between checking the Postgres disk capacity for automated pruning operations. Default is 1 hour.
1. Review the **Log level for push apps** value.
   You can set the log level for the `push-apps` errand to suit your troubleshooting needs. The options are `error`, `warning`, `info`, `debug`, or `trace`. Default level is `error`.
1. Click **Save**.

#### Configure Resources

To configure the **Resource Config** pane, do the following:

1. Click **Resource Config**.
1. Review the resource configurations. By default, the settings match the instance types that are best suited for each job.
   For reference, the following table shows the default resource and IP requirements for installing the PCF App Metrics tile:
  <table border="1" class="nice">
    <thead>
    <tr>
      <th>Resource</th>
      <th>Instances</th>
      <th>Persistent</th>
      <th>CPU</th>
      <th>RAM</th>
      <th>Ephemeral</th>
      <th>Static IP</th>
      <th>Dynamic IP</th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <td>PostgreSQL Logs Storage</td>
      <td>1 (Not configurable)</td>
      <td>500&nbsp;GB</td>
      <td>4</td>
      <td>16&nbsp;GB</td>
      <td>32&nbsp;GB</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <td>Redis</td>
      <td>1 (Not configurable)</td>
      <td>100&nbsp;GB</td>
      <td>2</td>
      <td>4&nbsp;GB</td>
      <td>8&nbsp;GB</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <td>MySQL Metrics Storage</td>
      <td>1 (Not configurable)</td>
      <td>500&nbsp;GB</td>
      <td>4</td>
      <td>16&nbsp;GB</td>
      <td>32&nbsp;GB</td>
      <td>1</td>
      <td>0</td>
    </tr>
    </tbody>
  </table> 
    If you expect a high level of use, you might need to increase the disk resources available to your instances. 
    For more information, see [Sizing PCF App Metrics for Your System](./sizing.html).
  
    <p class="note"><strong>Note:</strong> For Ops Manager v1.9, if you configure a job with persistent disk larger than 2&nbsp;TB,
       you might experience disk partitioning issues with the BOSH Director.</p>

1. Click **Save**.

#### Optional: Forward PCF App Metrics Logs to a Syslog Endpoint

Operators can configure PCF App Metrics to forward its process and VM logs to a logging solution through a syslog endpoint.

<p class='note'><strong>Note</strong>: Ops Manager 2.4 or later is required to configure PCF App Metrics to forward logs to a syslog endpoint. For information about upgrading Ops Manager, see <a href='https://docs.pivotal.io/pivotalcf/2-4/pcf-release-notes/opsmanager-rn.html#how-to-upgrade'>PCF Ops Manager 2.4 Release Notes</a>.</p>

To configure PCF App Metrics to forward logs to a syslog endpoint, do the following:

1. In the PCF App Metrics tile, click **Settings**, then click **Syslog**. 
   <%= image_tag("syslog2.png", :alt => "Syslog Settings") %>

1. For **Do you want to configure Syslog forwarding?**, select **Yes**.
   <%= image_tag("syslog3.png", :alt => "Enable Syslog Form") %>

1. For **Address** and **Port**, enter the address and port of the syslog server. For **Transport Protocol**, select the desired transport protocol. 
   <%= image_tag("syslog4.png", :alt => "Syslog Config") %>

1. (Optional) Select the **Enable TLS** checkbox to enable TLS. If you enable TLS, enter the **Permitted Peer** and **SSL Certificate**. 
   <%= image_tag("syslog5.png", :alt => "Syslog TLS Settings") %>

1. For **Queue Size**, enter the number of log messages the syslog server buffer holds before dropping messages. By default, the queue size is 100000. 
   <p class='note'><b>Note</b>: Pivotal recommends a queue size of 100000 or less. A queue size larger than 100000 may cause performance issues.</p>
   <%= image_tag("syslog6.png", :alt => "Syslog Queue Settings") %>

1. Click **Save**. 

1. Navigate to the Ops Manager **Installation Dashboard** and run the PCF App Metrics errands to apply your changes. 

####  Import Stemcell

To import the correct stemcell, follow the procedure in [Importing and Managing Stemcells](https://docs.pivotal.io/pivotalcf/opsguide/managing-stemcells.html).  

<p class='note'><strong>Note:</strong> PCF App Metrics 1.6 requires the Xenial stemcell line.</p>

### Deploy PCF App Metrics

To deploy PCF App Metrics, do the following:  

1. If you are using Ops Manager v2.3 or later, click **Review Pending Changes**. 
For more information about this Ops Manager page, 
see [Reviewing Pending Product Changes](https://docs.pivotal.io/pivotalcf/customizing/review-pending-changes.html).
1. Click **Apply Changes** to install the service.
If the smoke tests fail, see [Smoke Test Errors](./troubleshooting.html#smoke-test) in _Troubleshooting PCF App Metrics_.

For more information on how to log in, use, and interpret data from PCF App Metrics, see [Monitoring and Troubleshooting Apps with PCF App Metrics](./using.html). -->
